# Technical Debt Register (2026-02-14)

This register tracks known debt discovered during migration hardening.

Severity scale:

- **S1 (Critical):** can break CI/release integrity or correctness guarantees.
- **S2 (High):** meaningful reliability/perf/maintainability risk.
- **S3 (Medium):** important cleanup/refactor opportunity.
- **S4 (Low):** quality polish / future optimization.

Ownership tags are subsystem owners (team-level), not individual names.

## Open debt items

| Debt ID | Area | Description | Severity | Owner Tag | Source | Status |
| ------- | ---- | ----------- | -------- | --------- | ------ | ------ |


## Closed debt items (resolved in migration cycle)

| Debt ID | Area                                               | Resolution                                                                                                                                                                                                                         | Severity at close | Owner Tag             |
| ------- | -------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------- | --------------------- |
| TD-C001 | Security/audit                                     | Removed vulnerable dependency chains and reached `npm audit --omit=optional` = 0 vulnerabilities.                                                                                                                                  | S1                | `@repo-tooling`       |
| TD-C002 | Contract drift                                     | Added runtime + test-level schema validation gates for v1 payloads.                                                                                                                                                                | S1                | `@contracts-api`      |
| TD-C003 | CI parity drift                                    | Consolidated quality gates into shared scripts and cross-workflow parity commands (`ci:local`, `automation:check`).                                                                                                                | S2                | `@automation-tooling` |
| TD-C004 | Pre-commit architecture                            | Migrated from deprecated `scripts.precommit` hook discovery to explicit `husky.hooks.pre-commit` wiring (`precommit:hook`).                                                                                                        | S3                | `@repo-tooling`       |
| TD-C005 | Dist/build policy ergonomics                       | Added dedicated contributor guidance for intentional generated-artifact commits, including per-command override usage and safeguards (`generated-artifact-commit-policy-2026-02-14.md`).                                           | S4                | `@repo-tooling`       |
| TD-C006 | Core memory mapping contract                       | Added periodic wasm-export contract check (`core:memory-offset:check`) plus script-level regression coverage to enforce invalid-offset sentinel and valid-boundary mappings.                                                       | S2                | `@core-memory`        |
| TD-C007 | Core save/load determinism                         | Classified volatile `WASMBOY_STATE` byte offsets and enforced non-volatile determinism in serialization regression coverage (`core-save-state-volatile-field-classification-2026-02-14.md`).                                       | S2                | `@core-state`         |
| TD-C008 | Automation parser complexity                       | Added shared schema-driven throw-case registration helper (`scripts/test-schema-helpers.mjs`) and migrated repeated parser validation suites to the shared fixture pattern.                                                        | S4                | `@automation-tooling` |
| TD-C009 | Wrapper allocation pressure                        | Refactored snapshot fallback reads to batch register-block fetches and selective layer retrieval for `getPpuSnapshotLayers`, preventing full snapshot allocations for partial layer requests.                                      | S3                | `@wrapper-voxel`      |
| TD-C010 | Wrapper direct memory                              | Implemented capability-based `getDirectMemoryAccess()` using optional sync hooks (`_getWasmMemoryView` / `_getWasmMemoryBuffer`) with bounds validation and wrapper readiness integration coverage.                                | S4                | `@wrapper-voxel`      |
| TD-C011 | Debugger worker lifecycle                          | Added worker restart telemetry events, capped exponential backoff tuning, and surfaced restart diagnostics in debugger UI state (`apps/debugger/lib/worker-loader.ts`, `apps/debugger/app/page.tsx`).                              | S3                | `@debugger-runtime`   |
| TD-C012 | Debugger large-dataset UX                          | Added paginated timeline deep-inspection UX with oldest/older/newer/newest controls and tested page-window selection helpers for large snapshot histories.                                                                         | S4                | `@debugger-ui`        |
| TD-C013 | Core memory banking                                | Split `handleBanking` branch fan-out into focused banking helpers (RAM enable, ROM lower bits, RAM/upper ROM select, mode toggles) while preserving behavior and validating with core/integration tests.                           | S3                | `@core-memory`        |
| TD-C014 | Core sound perf/clarity                            | Consolidated repeated sound-channel frequency synchronization writes into shared `syncFrequencyFromRegisters()` helpers across channels 1-3, reducing redundant update sites while preserving behavior.                            | S3                | `@core-audio`         |
| TD-C015 | Core graphics perf                                 | Hoisted frame-stable config/mode branches out of background pixel loops and cached per-iteration scanline cycle budget in graphics update loop; validated with throughput + headless integration tests.                            | S3                | `@core-graphics`      |
| TD-C016 | Integration artifact hygiene                       | Updated headless integration output paths to `.output` artifacts and expanded cleanup automation to remove integration `.output` files, preventing accidental tracked screenshot churn during local tests.                         | S4                | `@repo-tooling`       |
| TD-C017 | Integration cleanup defaults                       | Added cleanup-wrapped headless integration commands and routed aggregate integration scripts to use them by default, preventing residual output artifact accumulation in local/CI workflows.                                       | S4                | `@repo-tooling`       |
| TD-C018 | Integration script contracts                       | Added package-script contract regressions to enforce cleanup-wrapped headless integration wiring (`scripts/package-scripts-contract.test.mjs`) across aggregate integration commands.                                              | S4                | `@automation-tooling` |
| TD-C019 | Integration staging guard                          | Extended generated-artifact pre-commit guard to block staged `test/integration/*.output` artifacts and updated policy docs/tests to prevent accidental commit churn from transient headless outputs.                               | S4                | `@repo-tooling`       |
| TD-C020 | Accuracy/perf staging guard                        | Extended generated-artifact pre-commit guard to block non-golden `test/accuracy/testroms` outputs and non-baseline `test/performance/testroms` PNG artifacts while allowing golden/baseline files.                                 | S4                | `@repo-tooling`       |
| TD-C021 | Artifact policy parity                             | Added artifact-policy parity regressions to ensure cleanup and staging-guard behavior remain aligned across generated test outputs and approved baseline artifacts.                                                                | S4                | `@automation-tooling` |
| TD-C022 | Artifact policy centralization                     | Consolidated generated-artifact policy rules into a shared module (`scripts/artifact-policy.mjs`) consumed by both cleanup and pre-commit guard scripts, reducing duplicated logic and drift risk.                                 | S4                | `@automation-tooling` |
| TD-C023 | Artifact policy source tests                       | Added direct unit coverage for shared artifact-policy helper predicates and path normalization to lock generated-artifact classification behavior independent of wrapper scripts.                                                  | S4                | `@automation-tooling` |
| TD-C024 | Cleanup dry-run ergonomics                         | Added `clean-accidental-build-artifacts` CLI flag parsing (`--dry-run`, `--help`) with dry-run candidate reporting and parser regressions to support safer local artifact policy verification workflows.                           | S4                | `@automation-tooling` |
| TD-C025 | Cleanup dry-run discoverability                    | Added package script and contract coverage for `clean:artifacts:precommit:dry-run` plus README/policy docs so dry-run artifact inspection stays visible and regression-checked across contributor workflows.                       | S4                | `@automation-tooling` |
| TD-C026 | Guard CLI usability                                | Added generated-artifact guard CLI parser/help contract (`--help`, unknown-flag rejection) with regression tests so manual pre-commit guard invocation has explicit, validated usage behavior.                                     | S4                | `@automation-tooling` |
| TD-C027 | Artifact CLI executable contracts                  | Added subprocess-driven CLI contract tests covering cleanup/guard script usage and unknown-flag behavior, protecting executable interface guarantees beyond direct function-level tests.                                           | S4                | `@automation-tooling` |
| TD-C028 | Artifact CLI diagnostic clarity                    | Removed duplicate script-prefix noise from cleanup/guard unknown-flag parser failures and refreshed function + subprocess contract tests so diagnostics stay concise and actionable.                                               | S4                | `@automation-tooling` |
| TD-C029 | Guard blocked-path dedupe                          | De-duplicated normalized blocked artifact paths in `findBlockedArtifactPaths` and added regression coverage so pre-commit diagnostics remain concise under duplicate path alias staging scenarios.                                 | S4                | `@automation-tooling` |
| TD-C030 | Artifact policy normalization reuse                | Consolidated shared artifact-policy predicate flow to avoid redundant normalization between remove/block helpers and added windows-path generated-output block coverage to protect cross-platform behavior.                        | S4                | `@automation-tooling` |
| TD-C031 | Cleanup CLI behavior contracts                     | Added subprocess-level dry-run vs destructive cleanup behavior tests in temporary workspaces to ensure command-line cleanup semantics stay correct beyond internal helper unit coverage.                                           | S4                | `@automation-tooling` |
| TD-C032 | Artifact policy input guards                       | Added explicit string-parameter validation in shared artifact-policy helpers plus non-string regression tests, making consumer contract violations fail fast with actionable diagnostics.                                          | S4                | `@automation-tooling` |
| TD-C033 | Guard input contract checks                        | Added strict staged-path input validation (array + string entries) in `findBlockedArtifactPaths` with regression coverage to prevent opaque failures from malformed guard helper consumers.                                        | S4                | `@automation-tooling` |
| TD-C034 | Cleanup JSON output contract                       | Added `clean-accidental-build-artifacts --json` support with parser + subprocess regression coverage, providing deterministic machine-readable cleanup summaries for automation and tooling integrations.                          | S4                | `@automation-tooling` |
| TD-C035 | Guard JSON output contract                         | Added `guard-generated-artifacts-precommit --json` support with parser/help and subprocess regression coverage to expose deterministic machine-readable staged-artifact validation summaries.                                      | S4                | `@automation-tooling` |
| TD-C036 | Artifact JSON script discoverability               | Added npm script shortcuts plus package-script contract checks for cleanup/guard JSON summary commands, improving contributor discoverability and preventing script drift in machine-readable workflows.                           | S4                | `@automation-tooling` |
| TD-C037 | Guard JSON failure-mode contract                   | Added subprocess regression coverage for guard `--json` output under staged generated-artifact failures in isolated git repos, validating payload shape and non-zero exit behavior for CI consumers.                               | S4                | `@automation-tooling` |
| TD-C038 | Guard JSON override-mode contract                  | Added subprocess regression coverage for guard `--json` with `WASMBOY_ALLOW_GENERATED_EDITS=1`, ensuring machine-readable payload semantics remain correct when intentional generated-artifact overrides apply.                    | S4                | `@automation-tooling` |
| TD-C039 | CLI fixture deduplication                          | Refactored artifact CLI contract tests to use shared temporary git-repo setup helpers for staged generated-artifact scenarios, reducing duplicated setup code and improving maintainability of executable tests.                   | S4                | `@automation-tooling` |
| TD-C040 | Artifact CLI duplicate-flag contracts              | Enforced duplicate-flag rejection for cleanup/guard CLI parsers (`--dry-run`, `--json`, help aliases) with unit and executable regression coverage to keep argument handling deterministic and user-facing errors clear.           | S4                | `@automation-tooling` |
| TD-C041 | Artifact JSON timestamp metadata                   | Added `timestampMs` fields to cleanup/guard JSON summaries with executable contract and policy-doc updates so machine-readable artifact diagnostics carry traceable emission timing metadata.                                      | S4                | `@automation-tooling` |
| TD-C042 | Artifact parser argv contracts                     | Added strict argv array/token type validation in cleanup/guard parser helpers with regression coverage, preventing malformed internal consumer payloads from triggering opaque runtime parser failures.                            | S4                | `@automation-tooling` |
| TD-C043 | Artifact JSON schema versioning                    | Added `schemaVersion: 1` to cleanup/guard JSON summaries with executable contract and policy-doc updates so machine-readable consumers can detect payload evolution explicitly.                                                    | S4                | `@automation-tooling` |
| TD-C044 | Cleanup JSON apply-mode contract                   | Added subprocess coverage for cleanup `--json` apply mode to verify payload semantics and real artifact deletion behavior stay aligned for machine-readable automation consumers.                                                  | S4                | `@automation-tooling` |
| TD-C045 | Cleanup JSON no-op payload contract                | Added subprocess coverage for cleanup `--json` no-op runs to lock deterministic zero-removal payload semantics (`removedCount: 0`, empty deletion lists) for machine-readable automation consumers.                                | S4                | `@automation-tooling` |
| TD-C046 | Guard JSON no-op override contract                 | Added subprocess coverage for guard `--json` no-op runs with `WASMBOY_ALLOW_GENERATED_EDITS=1`, ensuring override metadata and success semantics remain explicit for machine-readable automation consumers.                        | S4                | `@automation-tooling` |
| TD-C047 | Guard blocked-path ordering contract               | Added subprocess coverage for guard `--json` multi-path staged artifact scenarios to lock deterministic sorted `blockedPaths` ordering in machine-readable payloads consumed by automation tooling.                                | S4                | `@automation-tooling` |
| TD-C048 | Artifact JSON metadata assertion reuse             | Refactored artifact CLI executable contracts to centralize strict metadata assertions (`schemaVersion`, positive integer `timestampMs`), reducing duplicate test logic while hardening machine-readable payload checks.            | S4                | `@automation-tooling` |
| TD-C049 | Artifact JSON tool attribution                     | Added explicit `tool` identifiers to cleanup/guard JSON summaries with executable contract and policy-doc updates so machine-readable consumers can deterministically attribute payload sources.                                   | S4                | `@automation-tooling` |
| TD-C050 | Cleanup helper options input contracts             | Added strict options-shape/type validation (`options`, `repoRoot`, `dryRun`) in `cleanAccidentalBuildArtifacts` with regression coverage, preventing malformed caller payloads from causing opaque runtime failures.               | S4                | `@automation-tooling` |
| TD-C051 | Guard helper options input contracts               | Added strict options-shape/type validation (`options`, `allowGeneratedEdits`) in `validateGeneratedArtifactStaging` with regression coverage, preventing malformed caller payloads from causing opaque runtime failures.           | S4                | `@automation-tooling` |
| TD-C052 | Artifact CLI help-first semantics                  | Implemented help-first argument handling in cleanup/guard parsers so `--help/-h` prints usage regardless of mixed flags, with parser + subprocess contracts to preserve deterministic operator experience.                         | S4                | `@automation-tooling` |
| TD-C053 | Artifact JSON explicit count fields                | Added explicit machine-readable count fields (`deletedDirectoryCount`, `deletedFileCount`, `blockedPathCount`) with executable contract and policy-doc updates so downstream automation can consume totals directly.               | S4                | `@automation-tooling` |
| TD-C054 | Artifact JSON count consistency checks             | Centralized executable-contract assertions that enforce JSON count-field/list-length consistency across cleanup/guard summary payload scenarios, reducing drift risk in machine-readable contract coverage.                        | S4                | `@automation-tooling` |
| TD-C055 | Artifact summary metadata contract reuse           | Introduced shared summary-contract helpers/constants for cleanup/guard JSON metadata (`schemaVersion`, tool IDs, timestamp validation) with direct helper tests, reducing duplicate contract logic and schema drift risk.          | S4                | `@automation-tooling` |
| TD-C056 | Artifact summary timestamp override                | Added shared support for deterministic summary timestamps via `WASMBOY_ARTIFACT_SUMMARY_TIMESTAMP_MS`, with helper validation and executable contracts proving override behavior for cleanup/guard JSON payloads.                  | S4                | `@automation-tooling` |
| TD-C057 | Timestamp override failure-mode contracts          | Added subprocess contracts for malformed `WASMBOY_ARTIFACT_SUMMARY_TIMESTAMP_MS` values to ensure cleanup/guard CLIs fail deterministically with non-zero exits and actionable diagnostics.                                        | S4                | `@automation-tooling` |
| TD-C058 | Timestamp override whitespace tolerance            | Added whitespace normalization for `WASMBOY_ARTIFACT_SUMMARY_TIMESTAMP_MS` parsing with helper/executable regression coverage, improving operator ergonomics while preserving strict positive-integer validation.                  | S4                | `@automation-tooling` |
| TD-C059 | Artifact timestamp source metadata                 | Added explicit `timestampSource` metadata (`system-clock` / `env-override`) in artifact JSON summaries with helper and executable contracts so downstream consumers can reason about timestamp provenance deterministically.       | S4                | `@automation-tooling` |
| TD-C060 | Artifact summary payload builder reuse             | Centralized cleanup/guard JSON payload construction in shared helper builders with strict input-contract tests, reducing duplicate summary assembly logic and machine-readable contract drift risk.                                | S4                | `@automation-tooling` |
| TD-C061 | Artifact JSON outcome convenience flags            | Added boolean outcome flags (`hasRemovals`, `hasBlockedPaths`) to cleanup/guard JSON summaries with helper and executable contract coverage, simplifying downstream automation branching logic.                                    | S4                | `@automation-tooling` |
| TD-C062 | Guard summary count invariant                      | Enforced shared guard-summary invariant (`stagedPathCount >= blockedPathCount`) with regression coverage, preventing impossible machine-readable payload combinations from propagating to automation consumers.                    | S4                | `@automation-tooling` |
| TD-C063 | Guard summary validity invariant                   | Enforced shared guard-summary validity invariant (`isValid` requires zero blocked paths) with regression coverage, preventing contradictory machine-readable payload states from propagating to automation consumers.              | S4                | `@automation-tooling` |
| TD-C064 | Artifact summary deterministic list order          | Added deterministic sorting for machine-readable summary list fields (`deletedDirectories`, `deletedFiles`, `blockedPaths`) in shared summary builders, with helper and executable contract coverage to prevent ordering drift.    | S4                | `@automation-tooling` |
| TD-C065 | Artifact summary locale-independent sort           | Replaced locale-sensitive path sorting with ordinal string comparison in artifact summary builders and added mixed-case regression coverage to lock cross-platform deterministic ordering in machine-readable payloads.            | S4                | `@automation-tooling` |
| TD-C066 | Artifact summary duplicate-path canonicalization   | De-duplicated repeated path entries in cleanup/guard summary builders before deriving totals, ensuring machine-readable path arrays and count fields remain canonical and consistent even under duplicate input paths.             | S4                | `@automation-tooling` |
| TD-C067 | Artifact summary separator canonicalization        | Normalized windows-style separators to POSIX slash form before summary de-duplication/sorting so mixed slash/backslash inputs produce canonical machine-readable path lists and consistent counts across platforms.                | S4                | `@automation-tooling` |
| TD-C068 | Post-migration audit backlog bootstrap             | Completed an end-to-end repository audit and published a prioritized 100-task implementation backlog with evidence/fix/acceptance/verification contracts in `docs/migration/repository-audit-backlog-2026-02-14.md`.               | S2                | `@triage`             |
| TD-C069 | Guard blocked-path locale-independent ordering     | Replaced locale-sensitive blocked-path sorting in generated-artifact guard evaluation with ordinal comparator semantics and added mixed-case contract coverage to keep machine-readable guard output deterministic across locales. | S4                | `@automation-tooling` |
| TD-C070 | Dependency freshness report deterministic ordering | Sorted dependency-freshness package report entries using ordinal ordering and added report-format regression coverage to keep machine-readable/readable output stable across runtimes.                                             | S4                | `@automation-tooling` |
| TD-C071 | Dependency freshness subprocess timeout guard      | Added configurable npm outdated timeout handling (`DEPENDENCY_FRESHNESS_NPM_TIMEOUT_MS`) with timeout-specific diagnostics and regression coverage, preventing indefinite dependency-freshness audit hangs.                        | S4                | `@automation-tooling` |
| TD-C072 | Security scan subprocess timeout guard             | Added configurable npm audit timeout handling (`SECURITY_SCAN_NPM_AUDIT_TIMEOUT_MS`) with timeout diagnostics and regression coverage, preventing indefinite workspace security scan hangs.                                        | S4                | `@automation-tooling` |
| TD-C073 | Release checklist subprocess timeout guard         | Added configurable npm publish dry-run timeout handling (`RELEASE_CHECKLIST_NPM_TIMEOUT_MS`) with package-context timeout diagnostics and regression coverage to prevent indefinite release checklist hangs.                       | S4                | `@automation-tooling` |
| TD-C074 | Generated artifact guard git timeout guard         | Added configurable staged-git inspection timeout handling (`GUARD_GENERATED_ARTIFACTS_GIT_TIMEOUT_MS`) with timeout diagnostics and regression coverage, preventing indefinite precommit guard hangs.                              | S4                | `@automation-tooling` |

## Triage cadence

- Re-rank severity weekly (or after major regressions).
- Move items to “Closed” only when code + tests + docs are landed.
- For S1/S2 items, include explicit issue links and milestone targets once
  formal tracker IDs are assigned.
